<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">

<head>

<meta charset="utf-8"></meta>
<meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
<meta name="viewport" content="width=device-width, initial-scale=1"></meta>
<meta name="description" content=""></meta>
<meta name="author" content=""></meta>

<title>动力电池系統配置</title>
<link rel="shortcut icon" th:href="@{/icon/logo.ico}" />
<!-- Bootstrap Core CSS -->
<link href="../home/vendor/bootstrap/css/bootstrap.min.css"
	th:href="@{/home/vendor/bootstrap/css/bootstrap.min.css}"
	rel="stylesheet">
</link>

<!-- MetisMenu CSS -->
<link href="../home/vendor/metisMenu/metisMenu.min.css"
	th:href="@{/home/vendor/metisMenu/metisMenu.min.css}" rel="stylesheet"></link>

<!-- DataTables CSS -->
<link href="../home/vendor/datatables-plugins/dataTables.bootstrap.css"
	th:href="@{/home/vendor/datatables-plugins/dataTables.bootstrap.css}"
	rel="stylesheet"></link>
<!-- DataTables Responsive CSS -->
<link
	href="../home/vendor/datatables-responsive/dataTables.responsive.css"
	th:href="@{/home/vendor/datatables-responsive/dataTables.responsive.css}"
	rel="stylesheet"></link>

<!-- Custom CSS -->
<link href="../home/dist/css/sb-admin-2.css"
	th:href="@{/home/dist/css/sb-admin-2.css}" rel="stylesheet"></link>

<!-- Morris Charts CSS -->
<link href="../home/vendor/morrisjs/morris.css"
	th:href="@{/home/vendor/morrisjs/morris.css}" rel="stylesheet"></link>

<!-- Custom Fonts -->
<link href="../home/vendor/font-awesome/css/font-awesome.min.css"
	th:href="@{/home/vendor/font-awesome/css/font-awesome.min.css}"
	rel="stylesheet" type="text/css"></link>

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

<style type="text/css" th:inline="text">
body {
	background: url([[@{/img/bgimg2.jpg}]]) no-repeat center center fixed;
}
</style>

</head>

<body>

	<div id="wrapper">

		<nav th:replace="fragments/header :: header"></nav>

		<div id="page-wrapper">
			<div class="row">
				<div class="col-lg-12">
					<h1 class="page-header">客户需求信息</h1>
				</div>
				<!-- /.col-lg-12 -->
			</div>
			<!-- /.row -->
			<div class="row">
				<div class="col-lg-12" sec:authorize="isAuthenticated()">
					<form class="form-horizontal" role="form" id="queryForm"
						th:action="@{/battery/combinationData}" method="post">
						<div class="form-group">
							<label class="col-xs-12 col-sm-2 control-label">电压(V)</label> <label
								for="dymin"
								class="col-xs-offset-1 col-xs-3 col-sm-offset-0 col-sm-1 control-label">最小值</label>
							<div class="col-xs-8 col-sm-4">
								<input type="text" class="form-control" id="dymin" name="dymin"
									placeholder="请输入电压最小值" required="required"
									pattern="^(([0-9]+[\.]?[0-9]+)|[1-9])$" title="请输入正数"></input>
							</div>
							<label for="dymax"
								class="col-xs-offset-1 col-xs-3 col-sm-offset-0  col-sm-1 control-label">最大值</label>
							<div class="col-xs-8 col-sm-4">
								<input type="text" class="form-control" id="dymax" name="dymax"
									placeholder="请输入电压最大值" required="required"
									pattern="^(([0-9]+[\.]?[0-9]+)|[1-9])$" title="请输入正数"></input>
							</div>
						</div>
						<div class="form-group">
							<label class="col-xs-12 col-sm-2 control-label">电量(Kwh)</label> <label
								for="dlmin" class="col-xs-offset-1 col-xs-3 col-sm-offset-0 col-sm-1 control-label">最小值</label>
							<div class="col-xs-8 col-sm-4">
								<input type="text" class="form-control" id="dlmin" name="dlmin"
									placeholder="请输入电量(Kwh)最小值" required="required"
									pattern="^(([0-9]+[\.]?[0-9]+)|[1-9])$" title="请输入正数"></input>
							</div>
							<label for="dlmax" class="col-xs-offset-1 col-xs-3 col-sm-offset-0 col-sm-1 control-label">最大值</label>
							<div class="col-xs-8 col-sm-4">
								<input type="text" class="form-control" id="dlmax" name="dlmax"
									placeholder="请输入电量(Kwh)最大值" required="required"
									pattern="^(([0-9]+[\.]?[0-9]+)|[1-9])$" title="请输入正数"></input>
							</div>
						</div>
						<div class="form-group">
							<label class="col-xs-12 col-sm-2 control-label">电池箱数量</label> <label
								for="dcxslmin" class="col-xs-offset-1 col-xs-3 col-sm-offset-0 col-sm-1 control-label">最小值</label>
							<div class="col-xs-8 col-sm-4">
								<input type="text" class="form-control" id="dcxslmin"
									name="dcxslmin" placeholder="请输入电池箱数量最小值" required="required"
									pattern="^\+?[1-9][0-9]*$" title="请输入正整数"></input>
							</div>
							<label for="dcxslmax" class="col-xs-offset-1 col-xs-3 col-sm-offset-0 col-sm-1 control-label">最大值</label>
							<div class="col-xs-8 col-sm-4">
								<input type="text" class="form-control" id="dcxslmax"
									name="dcxslmax" placeholder="请输入电池箱数量最大值" required="required"
									pattern="^\+?[1-9][0-9]*$" title="请输入正整数"></input>
							</div>
						</div>
						<!-- <div class="form-group">
							<label class="col-sm-2 control-label">车长</label>
							<div class="col-sm-10">
								<div class="checkbox">

									<label class="checkbox-inline"> <input type="radio"
										name="cc" id="optionsRadios1" value="TA" checked="checked">6~8米</input>
									</label> <label class="checkbox-inline"> <input type="radio"
										name="cc" id="optionsRadios2" value="TB">8~10米</input>
									</label> <label class="checkbox-inline"> <input type="radio"
										name="cc" id="optionsRadios3" value="TC">10~12米</input>
									</label> <label class="checkbox-inline"> <input type="radio"
										name="cc" id="optionsRadios4" value="TD">12米以上</input>
									</label>
								</div>
							</div>
						</div>-->
						<div class="form-group">
							<div class="col-xs-offset-4 col-xs-10 col-sm-offset-5 col-sm-10">
								<button type="submit" class="btn btn-primary" id="queryBtn">
									<span class="glyphicon glyphicon-search"></span>&nbsp;&nbsp;开始配置
								</button>
							</div>
						</div>
					</form>


				</div>
				<!-- /.col-lg-12 -->
			</div>
			<!-- /.row -->
			<!-- /.row -->
			<div class="row">
				<div class="col-lg-12">
					<div class="panel panel-primary table-responsive">
						<div class="panel-heading">配置结果</div>
						<!-- /.panel-heading -->
						<div class="panel-body">
							<table width="100%"
								class="table table-striped table-bordered table-hover"
								id="dataTables-results">
								<thead>
									<!-- <tr>
										<th rowspan="2">ID</th>
										<th rowspan="2">平台电压</th>
										<th rowspan="2">标称容量</th>
										<th rowspan="2">系统电量</th>
										<th colspan="4">系统配置方式</th>
										<th rowspan="2">系统重量</th>
										<th rowspan="2">系统能量密度</th>

									</tr>-->
									<tr>
										<th>序号</th>
										<th>ID</th>
										<th>平台电压(V)</th>
										<th>标称容量(Ah)</th>
										<th>系统电量(Kwh)</th>

										<th>A箱个数</th>
										<th>A箱代码</th>
										<th>B箱个数</th>
										<th>B箱代码</th>
										<th>A箱质量(不含PTC)Kg</th>
										<th>B箱质量(不含PTC)Kg</th>
										<th>系统重量(Kg)±5%</th>
										<th>系统能量密度(Wh/kg)</th>
										<th>车长</th>
										<th>操作</th>


									</tr>
								</thead>
								<tbody>

								</tbody>
							</table>
							<!-- /.table-responsive -->

						</div>
						<!-- /.panel-body -->
					</div>
					<!-- /.panel -->
				</div>
				<!-- /.col-lg-12 -->
			</div>
			<!-- /.row -->
			<!-- /.row -->
		</div>
		<!-- /#page-wrapper -->

	</div>
	<!-- /#wrapper -->

	<!-- logoutform -->
	<div th:replace="fragments/header :: logoutform"></div>

	<!-- jQuery -->
	<script src="../home/vendor/jquery/jquery.min.js"
		th:src="@{/home/vendor/jquery/jquery.min.js}"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="../home/vendor/bootstrap/js/bootstrap.min.js"
		th:src="@{/home/vendor/bootstrap/js/bootstrap.min.js}"></script>

	<!-- Metis Menu Plugin JavaScript -->
	<script src="../home/vendor/metisMenu/metisMenu.min.js"
		th:src="@{/home/vendor/metisMenu/metisMenu.min.js}"></script>

	<!-- Morris Charts JavaScript -->
	<script src="../home/vendor/raphael/raphael.min.js"
		th:src="@{/home/vendor/raphael/raphael.min.js}"></script>
	<script src="../home/vendor/morrisjs/morris.min.js"
		th:src="@{/home/vendor/morrisjs/morris.min.js}"></script>
	<script src="../home/data/morris-data.js"
		th:src="@{/home/data/morris-data.js}"></script>

	<!-- DataTables JavaScript -->
	<script src="../home/vendor/datatables/js/jquery.dataTables.min.js"
		th:src="@{/home/vendor/datatables/js/jquery.dataTables.min.js}"></script>
	<script
		src="../home/vendor/datatables-plugins/dataTables.bootstrap.min.js"
		th:src="@{/home/vendor/datatables-plugins/dataTables.bootstrap.min.js}"></script>
	<script
		src="../home/vendor/datatables-responsive/dataTables.responsive.js"
		th:src="@{/home/vendor/datatables-responsive/dataTables.responsive.js}"></script>


	<!-- Custom Theme JavaScript -->
	<script src="../home/dist/js/sb-admin-2.js"
		th:src="@{/home/dist/js/sb-admin-2.js}"></script>

	<script type="text/javascript">
		$(document).ready(function() {

			initDataTable();

			$('#triggerformsubmitlogout').click(function() {

				$('#submitlogout').trigger("click");
				return false;

			});

			$('#queryForm').on('submit', function(event) {
				var $form = $(this);

				event.preventDefault();

				queryData();
			});

			/*$('#queryBtn').click(function() {

				queryData();

			});*/

		});

		function queryData() {

			var queryPojo = new Object();

			queryPojo.dymin = $('#dymin').val();
			queryPojo.dymax = $('#dymax').val();
			queryPojo.dlmin = $('#dlmin').val();
			queryPojo.dlmax = $('#dlmax').val();
			queryPojo.dcxslmin = $('#dcxslmin').val();
			queryPojo.dcxslmax = $('#dcxslmax').val();
			//queryPojo.cc = $('input:radio[name="cc"]:checked').val();
			

			var json = JSON.stringify(queryPojo);

			//alert(json);
			
		/*	$.ajaxSetup({  
        contentType : 'application/json'  
    }); */

			$.ajax({
						type : $('#queryForm').attr("method"),
						contentType : 'application/json',
						url : $('#queryForm').attr("action"),
						data : json
					})
					.then(
							function(data) {

								//alert(data.msg);
								//alert(data.batteryConfigResult);

								if ($.fn.dataTable
										.isDataTable('#dataTables-results')) {
									var table = $('#dataTables-results')
											.DataTable();
									table.clear();
									table.destroy();
								}
								if (data.msg == "S") {
									var table = $('#dataTables-results')
											.DataTable(
													{

														"lengthChange" : false,//是否允许用户改变表格每页显示的记录数
														"searching" : false,//是否允许Datatables开启本地搜索
														/*pagingType选项来配置
														simple - 只有上一页、下一页两个按钮
														simple_numbers - 除了上一页、下一页两个按钮还有页数按钮，Datatables默认是这个
														full - 有四个按钮首页、上一页、下一页、末页
														full_numbers - 除首页、上一页、下一页、末页四个按钮还有页数按钮
														 */
														"pagingType" : "full_numbers",
														"language" : {
															"emptyTable" : "没有数据",
															"info" : "显示 _START_ 到  _END_ 方案,总计 _TOTAL_ 种方案",
															"infoEmpty" : "无方案显示",
															"paginate" : {
																"first" : "首页",
																"previous" : "上一页",
																"next" : "下一页",
																"last" : "尾页"
															}
														},
														data : data.batteryConfigResult,
														columns : [ {

															data : null
														}, {

															data : 'id'
														}, {

															data : 'dypt'
														}, {

															data : 'bcrl'
														}, {

															data : 'bcdl'
														}, {

															data : 'dxzhfs1'
														}, {

															data : 'dxzhfs2'
														}, {

															data : 'dxzhfs3'
														}, {

															data : 'dxzhfs4'
														}, {

															data : 'axzl'
														}, {

															data : 'bxzl'
														}, {

															data : null
														}, {

															data : 'dxnlmd'

														},{
															data : 'sycxdesc'
														},{

															data : null

														} ],
														"columnDefs" : [
																{
																	"render" : function(
																			data,
																			type,
																			row,
																			meta) {

																		return new Number(
																				row.axzl
																						* row.dxzhfs1
																						+ row.bxzl
																						* row.dxzhfs3)
																				.toFixed(3);
																	},
																	"targets" : 11

																},{
																	"targets" : 14,//操作按钮目标列
																
																	"data" : null,
																	 "defaultContent": "<button>Click!</button>",
																	 "render" : function(
																				data,
																				type,
																				row,
																				meta) {
																		 
																		 

																			return '<a href="/soundapp/report/view/'+row.id+'" target="_blank" class="btn btn-info" role="button" ><span class="glyphicon glyphicon-check"></span>&nbsp;&nbsp;'+"查看"+'</a>';
																		}

																},
																{
																	"visible" : false,
																	"targets" : [ 1 ]
																},
																{
																	"visible" : false,
																	"targets" : [ 9 ]
																},
																{
																	"visible" : false,
																	"targets" : [ 10 ]
																} ],
														"drawCallback" : function(
																settings) {
															var api = this
																	.api();
															
															　　//var startIndex= api.context[0]._iDisplayStart;//获取到本页开始的条数
															　　api.column(0).nodes().each(function(cell, i) {

															　　　　//此处 startIndex + i + 1;会出现翻页序号不连续，主要是因为startIndex 的原因,去掉即可。
															　　　　//cell.innerHTML = startIndex + i + 1;

															　　　　cell.innerHTML = "方案" + new Number(i + 1).toString();

															　　}); 

															//----------------------
														}
													/*,
													"formatNumber" : function(toFormat) {
														//使用正则表达式匹配，替换数字
														return toFormat.toFixed(3);
													}*/

													});
								} else if (data.msg == "F") {
									initDataTable();
								}

							});//then方法结束

		}

		/*初始化表格
		 */
		function initDataTable() {

			var table = $('#dataTables-results').DataTable({

				"lengthChange" : false,//是否允许用户改变表格每页显示的记录数
				"searching" : false,//是否允许Datatables开启本地搜索
				"language" : {
					"emptyTable" : "没有数据",
					"infoEmpty" : "无方案显示",
					"paginate" : {
						"previous" : "上一页",
						"next" : "下一页",
						"last" : "尾页"
					}
				},
				"columnDefs" : [ {
					"visible" : false,
					"targets" : [ 1 ]
				},{
					"visible" : false,
					"targets" : [ 9 ]
				}, {
					"visible" : false,
					"targets" : [ 10 ]
				} ]

			});

		}
	</script>
</body>

</html>
